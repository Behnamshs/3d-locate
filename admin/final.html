<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>پنل ادمین — داشبورد</title>
  <style>
    /* پایه — تم روشن مدرن */
:root{
  --bg:#f7f9fb;
  --card:#ffffff;
  --muted:#6b7280;
  --accent:#2f80ed;
  --danger:#e74c3c;
  --radius:12px;
  --shadow: 0 6px 18px rgba(20,30,50,0.06);
  --container-padding:20px;
}

*{box-sizing:border-box}
body{margin:0;font-family:tahoma, 'Segoe UI', Roboto, sans-serif;direction:rtl;background:var(--bg);color:#1f2937;}
.app{display:flex;min-height:100vh;}

/* topbar */
.topbar{position:fixed;left:0;right:0;top:0;height:64px;background:var(--card);display:flex;align-items:center;justify-content:space-between;padding:0 16px;border-bottom:1px solid #eef2f7;z-index:40}
.brand{font-weight:700;color:var(--accent)}
.burger{display:none;background:transparent;border:none;font-size:22px;cursor:pointer}
.top-actions{display:flex;gap:8px}
.icon-btn{background:transparent;border:1px solid #eef2f7;padding:8px;border-radius:8px;cursor:pointer}

/* sidebar */
.sidebar{width:260px;padding:calc(var(--container-padding));background:transparent;margin-top:64px}
.sidebar-inner{position:sticky;top:84px;background:var(--card);padding:16px;border-radius:var(--radius);box-shadow:var(--shadow)}
.logo{font-weight:700;margin-bottom:12px}
.menu{display:flex;flex-direction:column;gap:6px}
.menu-item{padding:10px 12px;border-radius:10px;color:#344055;text-decoration:none;font-weight:600}
.menu-item.active, .menu-item:hover{background:#f1f5f9;color:var(--accent)}

/* main */
.main{flex:1;margin-top:64px;padding:20px 24px}
.hero{background:linear-gradient(90deg,rgba(47,128,237,0.08),rgba(47,128,237,0.02));padding:18px;border-radius:12px;margin-bottom:18px;display:flex;flex-direction:column;gap:8px}
.cards{display:flex;gap:12px;margin-bottom:18px;flex-wrap:wrap}
.card{background:var(--card);padding:14px;border-radius:10px;box-shadow:var(--shadow);flex:1;min-width:160px}
.card-title{font-size:13px;color:var(--muted)}
.card-value{font-size:20px;font-weight:700;margin-top:6px}

/* boxes and list */
.box{background:var(--card);padding:16px;border-radius:12px;box-shadow:var(--shadow);margin-bottom:18px}
.list{display:flex;flex-direction:column;gap:12px}
.item{display:flex;gap:12px;align-items:center;padding:10px;border-radius:10px;background:#fff;border:1px solid #f0f3f7}
.item img{width:80px;height:80px;object-fit:cover;border-radius:8px}
.item .meta{flex:1}
.item .stats{min-width:120px;text-align:left;color:var(--muted)}

/* form */
.content-form{max-width:920px;margin:0 auto}
.form-card{display:flex;flex-direction:column;gap:12px;background:var(--card);padding:16px;border-radius:12px;box-shadow:var(--shadow)}
label{font-weight:600;color:#263238}
input[type="text"],select,textarea,input[type="file"]{width:100%;padding:10px;border:1px solid #e6eef6;border-radius:10px;background:transparent}
.preview{width:120px;height:120px;object-fit:cover;border-radius:10px;border:1px solid #eef2f7;display:none;margin-top:8px}
.error{color:var(--danger);font-size:13px;margin-top:6px}
.threeD-section{padding:12px;border-radius:10px;border:1px dashed #e6eef6;background:#fbfdff;text-align:center}

/* buttons */
.btn{padding:10px 12px;border-radius:10px;border:1px solid transparent;background:#f3f6fb;cursor:pointer}
.btn.primary{background:var(--accent);color:#fff;border:none}
.btn.danger{background:var(--danger);color:#fff;border:none}

/* tables */
.table-wrap{overflow:auto}
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:10px;border-bottom:1px solid #f0f3f7;text-align:center}
.table thead th{background:#fafbfd;color:#344055}

/* responsive tables -> card style */
@media (max-width:900px){
  .sidebar{display:none}
  .burger{display:block}
  .app{flex-direction:column}
  .main{margin-top:80px;padding:16px}
  .table, .table thead, .table tbody, .table th, .table td, .table tr {display:block;width:100%}
  .table thead {display:none}
  .table tr {background:var(--card);margin-bottom:12px;padding:14px;border-radius:12px;box-shadow:var(--shadow)}
  .table td {display:flex;justify-content:space-between;padding:8px;border:none}
  .table td::before{content:attr(data-label);font-weight:700;color:var(--muted);margin-right:8px}
  .item{flex-direction:row;align-items:center}
  .cards{flex-direction:column}
  .preview{width:96px;height:96px;display:block}
}

/* small phones tweaks */
@media (max-width:420px){
  .brand{font-size:15px}
  .card-value{font-size:18px}
  .item img{width:64px;height:64px}
  .preview{width:80px;height:80px}
}

  </style>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
  <div class="app">
    <header class="topbar">
      <button class="burger" id="burger" aria-label="باز/بسته کردن منو">☰</button>
      <div class="brand">پنل ادمین</div>
      <div class="top-actions">
        <button class="icon-btn">🔔</button>
        <button class="icon-btn">⚙️</button>
      </div>
    </header>

    <aside class="sidebar" id="sidebar">
      <div class="sidebar-inner">
        <div class="logo">لوگو</div>
        <nav class="menu">
          <a href="index.html" class="menu-item active">داشبورد</a>
          <a href="add-business.html" class="menu-item">افزودن کسب‌وکار</a>
          <a href="user-dashboard.html" class="menu-item">کاربران و تعاملات</a>
          <a href="delete-dashboard.html" class="menu-item">حذف‌ها</a>
        </nav>
      </div>
    </aside>

    <main class="main">
      <section class="hero">
        <h1>خوش آمدید</h1>
        <p>اینجا مدیریت کسب‌وکارها، کاربران و تعاملات را انجام دهید.</p>
      </section>

      <section class="cards">
        <div class="card">
          <div class="card-title">کسب‌وکارهای فعال</div>
          <div class="card-value">۱۲۴</div>
        </div>
        <div class="card">
          <div class="card-title">کاربران ثبت‌شده</div>
          <div class="card-value">۳۸۰</div>
        </div>
        <div class="card">
          <div class="card-title">کامنت‌های جدید</div>
          <div class="card-value">۲۱</div>
        </div>
      </section>

      <section class="recent box">
        <h2>آخرین کسب‌وکارهای ثبت‌شده</h2>
        <div class="list">
          <article class="item">
            <img src="../img/cafe1.jpg" alt="کافه" />
            <div class="meta">
              <div class="title">کافه لاله‌زار</div>
              <div class="sub">کافه — تهران</div>
            </div>
            <div class="stats">
              <div>بازدید: ۱۵۲</div>
              <div>لایک: ۴۷</div>
            </div>
          </article>
          <article class="item">
            <img src="../img/resturant1.jpg" alt="رستوران" />
            <div class="meta">
              <div class="title">رستوران نیاوران</div>
              <div class="sub">رستوران — تهران</div>
            </div>
            <div class="stats">
              <div>بازدید: ۸۹</div>
              <div>لایک: ۲۳</div>
            </div>
          </article>
        </div>
      </section>
    </main>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    /* common behavior for sidebar burger and form/map/validations */
function setupBurger(burgerId, sidebarId) {
  const burger = document.getElementById(burgerId);
  const sidebar = document.getElementById(sidebarId);
  if (!burger || !sidebar) return;
  burger.addEventListener('click', () => {
    sidebar.classList.toggle('open');
  });
}

/* initialize burgers for pages */
setupBurger('burger','sidebar');
setupBurger('burger2','sidebar2');
setupBurger('burger3','sidebar3');
setupBurger('burger4','sidebar4');

/* ===== form validations and image checks (square images) ===== */
function countWords(text){
  const cleaned = text.replace(/\u200C/g,' ').trim();
  const m = cleaned.match(/\S+/g);
  return m ? m.length : 0;
}
function firstNWords(text,n){
  const cleaned = text.replace(/\u200C/g,' ').trim();
  const m = cleaned.match(/\S+/g) || [];
  return m.slice(0,n).join(' ');
}
function checkImageIsSquare(file){
  return new Promise((res,rej)=>{
    if(!file) return rej('فایل انتخاب نشده');
    if(!file.type || !file.type.startsWith('image/')) return rej('فایل تصویر نیست');
    const r = new FileReader();
    r.onload = e => {
      const img = new Image();
      img.onload = ()=>{
        if(img.naturalWidth !== img.naturalHeight) rej('تصویر مربع نیست');
        else res();
      };
      img.onerror = ()=> rej('خواندن تصویر ناموفق');
      img.src = e.target.result;
    };
    r.onerror = ()=> rej('خطای خواندن فایل');
    r.readAsDataURL(file);
  });
}

/* preview and quick check */
function handlePreviewAndValidate(inputEl, previewEl, errorEl){
  const file = inputEl.files && inputEl.files[0];
  errorEl.textContent='';
  previewEl.style.display='none';
  if(!file) return;
  if(!file.type || !file.type.startsWith('image/')){
    errorEl.textContent='فایل تصویر نیست';
    return;
  }
  const url = URL.createObjectURL(file);
  previewEl.src = url;
  previewEl.style.display='block';
  const img = new Image();
  img.onload = ()=>{
    if(img.naturalWidth !== img.naturalHeight) errorEl.textContent='تصویر مربع نیست';
    else errorEl.textContent='';
    URL.revokeObjectURL(url);
  };
  img.onerror = ()=>{ errorEl.textContent='خطای نمایش تصویر'; URL.revokeObjectURL(url); };
  img.src = url;
}

/* add listeners if form exists */
const form = document.getElementById('businessForm');
if(form){
  const mainImageInput = document.getElementById('mainImage');
  const logoInput = document.getElementById('logo');
  const mainImageError = document.getElementById('mainImageError');
  const logoError = document.getElementById('logoError');
  const mainPreview = document.getElementById('mainImagePreview');
  const logoPreview = document.getElementById('logoPreview');
  const desc = document.getElementById('description');
  const descCounter = document.getElementById('descCounter');
  const locationInput = document.getElementById('location');
  const mapError = document.getElementById('mapError');

  mainImageInput.addEventListener('change', ()=> handlePreviewAndValidate(mainImageInput, mainPreview, mainImageError));
  logoInput.addEventListener('change', ()=> handlePreviewAndValidate(logoInput, logoPreview, logoError));

  desc.addEventListener('input', ()=>{
    const n = countWords(desc.value);
    if(n>85){
      desc.value = firstNWords(desc.value,85);
      descCounter.textContent = '85';
    } else descCounter.textContent = String(n);
  });

  /* init leaflet map */
  try{
    const map = L.map('map').setView([35.6892,51.3890],12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'© OpenStreetMap contributors'}).addTo(map);
    let marker;
    map.on('click', function(e){
      const lat = e.latlng.lat;
      const lng = e.latlng.lng;
      if(marker) map.removeLayer(marker);
      marker = L.marker([lat,lng]).addTo(map);
      locationInput.value = lat + ',' + lng;
      mapError.textContent='';
    });
  }catch(e){
    if(document.getElementById('mapError')) document.getElementById('mapError').textContent = 'خطا در بارگذاری نقشه';
    console.error(e);
  }

  form.addEventListener('submit', async function(ev){
    ev.preventDefault();
    // validate description
    const n = countWords(desc.value);
    if(n>85){ alert('توضیحات بیش از 85 کلمه است'); return; }
    if(!locationInput.value){ alert('لوکیشن انتخاب نشده'); return; }

    const mainFile = mainImageInput.files[0];
    const logoFile = logoInput.files[0];
    try{ await checkImageIsSquare(mainFile); } catch(err){ mainImageError.textContent = String(err); mainImageInput.focus(); return; }
    try{ await checkImageIsSquare(logoFile); } catch(err){ logoError.textContent = String(err); logoInput.focus(); return; }

    alert('ولیدیشن موفق — آماده ارسال به سرور (در نسخه نمونه فقط پیام نمایش داده می‌شود)');
  });
}

/* deletable rows behavior with confirm */
document.addEventListener('click', function(e){
  if(e.target && e.target.classList.contains('delete-btn')){
    if(confirm('آیا از حذف مطمئن هستید؟')){
      const tr = e.target.closest('tr');
      if(tr) tr.remove();
    }
  }
});
  </script>
</body>
</html>
